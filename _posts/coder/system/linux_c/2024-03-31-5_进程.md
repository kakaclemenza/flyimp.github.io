---
layout: post
title: 5_进程
category: coder
typora-root-url: ../../../..
---





### 子进程创建

**(1) fork**

现今的fork, 出于效率考虑, 引入了“写时复制“技术(Copy-On-Write), 所以fork结束后子进程的虚拟地址空间其实也是映射和父进程相同的物理地址空间, **物理页被共享**, 当父子进程其中任意一方要写某物理页面时, 触发写错误, 引起"写时复制"出一个新物理页, 修改子进程的虚拟页映射.

注意, fork时会分配新的虚拟地址空间, 分配规则详见内核源码, 一般策略是与现有可用物理内存+swap挂钩. **如果须分配的虚拟地址空间大于现有可用物理内存+swap, fork()调用会失败!** 所以在大内存进程中, 如果使用fork()+exec()只为了执行下shell命令, 较大可能会失败.

最好的方法是, **使用vfork()**, 则子进程连虚拟地址空间也不会分配, 直接使用父进程的. 

**(2) vfork**



### 进程间通信

任意选一本讲linux系统编程的书籍, 应该都会提到进程间通信. 可以实现进程间通信的方式多种多样, 本质上就是要陷入到系统空间中, 才能够通过共享的地址空间实现进程间通信. 

在系统空间中, 由于各个线程的地址空间都是共享的，即一个线程能够随意访问kernel中的任意地址，所以无需进程通信机制的保护。而在**用户空间**中，每个进程都有自己的地址空间，一个进程为了与其他进程通信，必须**陷入**到有足够权限访问其他进程空间的kernel中，从而与其他进程进行通信



**IPC信号量与clib 信号量关系**

IPC信号量是内核提供的系统调用, 使用方式如下:

```

```

clib信号量, 主要是pthread封装的, 使用方式如下


