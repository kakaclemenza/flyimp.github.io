---
layout: post
title: 令牌桶算法
category: coder
typora-root-url: ../../../..
---

这个听起来很高大上的东西, 其实是比较简单的. 主要思想就是在正常的处理流程插入一个中间缓冲区域, 保证该区域的输出是均匀的, 过多的输入则会消耗缓冲区域的空间, 即"消耗令牌数量", 缓冲区域满了则把多余的输入直接丢弃.

令牌桶算法是**网络流量整形（Traffic Shaping）和速率限制（Rate Limiting）**中最常使用的一种算法。典型情况下，令牌桶算法用来控制发送到网络上的数据的数目，并允许突发数据的发送。

大小固定的令牌桶可自行以恒定的速率源源不断地产生令牌。如果令牌不被消耗，或者被消耗的速度小于产生的速度，令牌就会不断地增多，直到把桶填满。后面再产生的令牌就会从桶中溢出。最后桶中可以保存的最大令牌数永远不会超过桶的大小。

传送到令牌桶的数据包需要消耗令牌。不同大小的数据包，消耗的令牌数量不一样。

令牌桶这种控制机制基于令牌桶中是否存在令牌来指示什么时候可以发送流量。令牌桶中的每一个令牌都代表一个字节。如果令牌桶中存在令牌，则允许发送流量；而如果令牌桶中不存在令牌，则不允许发送流量。因此，如果突发门限被合理地配置并且令牌桶中有足够的令牌，那么流量就可以以峰值速率发送

