---
layout: post
title: 内核学习历程
category: thoughts
---

### 参考

陆游 给世人留下很经典的一句话”工夫在诗外“，这里我想说一句，学习内核功能在代码之外。下面我说一个可操作的”方案“吧。

1、首先要搭建一个Linux的学习环境：建议使用Qemu虚拟机装一个标准的Ubuntu Linux，学习简单的Linux使用方法，更重要的是学习编译Linux内核
2、从《LINUX设备驱动程序》这本书入手，掌握编写标准的虚拟字符驱动方法，并亲自动写一个，验证通过
3、在基于2)的代码里，对于open/write钩子调用backtrace函数输出驱动file_operations钩子函数的执行上下文，并根据backtrace调用栈，看每个函数上简单看一下它们长什么样，如果能分析到这些函数属于那个功能模块（比如syscall, vfs，device,……）就更好了。
4、再从通用的、基础的功能模块开始学起，比如系统调用原理，中断处理，……
5、第4）点任何知识学习时，建议找相关的参考书帮自己梳理知识脉络，更重的是动手修改代码验证自己的理解；比如新增一个系统调用，注册一个中断处理函数，看看执行起来是什么样子的。
6、经过第5阶段的学习，可以系统学习某些大功能模块的机理了，比如虚拟内存、CFS调度算法，PageCache管理，某个文件系统(比如ext2)，网络协议栈t等。
7、学会使用kernel的调试工具，比如qemu + gdb调用内核，还有内核自身提供的ftrace, perf等功能都是很好的测量和分析工具

总体思路：看经典书籍理清知识脉络 + 自己动手分析代码 + 编写代码验证或使用工具进行验证分析进阶路径：先从基础的功能模块，再到复杂的子系统学习最后说说我自己学习内核的过程吧：

第一阶段是巧遇期（兴趣使然）：第一份工作是与网络相关，自学了《LINUX设备驱动程序》这本书的字符驱动，然后学习了网络驱动部分，然后沿着驱动里面调用的netif_rx函数，将内核协议栈代码看了一遍。

第二阶段是应用期（工作需要）：通过项目和自学方式，掌握内存、调度这两个重要的子系统，还有一些调测工具的原理（比如perf, ftrace, backtrace，……）；然后也向内核社区提交过patch

第三阶段：应该是整体Linux的方案设计和需求分析工作，这个阶段更好是将内核好的功能，解决客户的痛点问题，给出一个好的解决方案。