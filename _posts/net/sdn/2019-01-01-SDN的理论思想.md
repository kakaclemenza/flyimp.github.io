---
layout: post
title: sample
category: net
tag: sdn
typora-root-url: ../../..
---

## SDN概念

软件定义网络（Software Defined Networking,SDN）是一种新型的网络技术，其设计理念是将网络的控制平面与数据转发平面进行分离，并实现可编程化的集中控制。

传统网络设备紧耦合的网络架构被分拆成应用、控制、转发三层分离的架构。控制功能被转移到了服务器，上层应用、底层转发设施被抽象成多个逻辑实体。

### SDN的特征

SDN三个主要特征：

- **转控分离**：网元的控制平面在控制器上，负责协议计算，产生流表；而转发平面只在网络设备上。
- **集中控制**：设备网元通过控制器集中管理和下发流表，这样就不需要对设备进行逐一操作，只需要对控制器进行配置即可。
- **开放接口**：第三方应用只需要通过控制器提供的开放接口，通过编程方式定义一个新的网络功能，然后在控制器上运行即可。

SDN关键技术体系：

![SDN技术体系](/img/sdn/sdn_define.png)

### SDN价值

* 网络业务快速创新
* 简化网络
* 网络设备白牌化
* 业务自动化
* 网络路径流量优化

## SDN接口

![SDN接口](/assets/2019-01-01-SDN%E7%9A%84%E7%90%86%E8%AE%BA%E6%80%9D%E6%83%B3/SDN%E6%8E%A5%E5%8F%A3.png)

### SDN南向接口

SDN南向接口的关键技术是转发面开放协议，该协议允许网络控制器控制交换机的配置以及相关转发行为。

Openflow是ONF定义的一个转发面控制协议，它将转发面抽象为一个由多级流表组成的转发模型，网络控制器通过Openflow协议下发Openflow流表到具体交换机，从而定义、控制交换机的具体行为。

OpenFlow是一整套软件应用程序接口，OpenFlow 控制器可以通过规范与支持OpenFlow 交换机沟通配置信息，决定数据转发平面的转发表，控制器与交换机间通过SSL 加密传输。

OF-CONFIG （OpenFlow配置和管理协议）由ONF控制和管理工作组制定和维护，是OpenFlow协议的同伴协议，是在包含OpenFlow交换机的运营环境下，除OpenFlow协议之外的接口配置和管理协议规范，目前采用NETCONF协议进行传输。

Openflow以及OF-Config提供了灵活、开放的手段，但是也有许多尚待改进的地方：
1.现有转发面硬件芯片无法在所有Openflow流表中支持协议中定义的匹配字段，导致Openflow协议灵活性大打折扣，也为网络控制器控制异构Openflow交换机增加了难度；
2.Openflow协议中仅仅支持了部分现有网络封包格式，后续对于协议的扩展也会存在类似标准化周期过长的问题。

### SDN北向接口

SDN控制层将网络能力封装为开放的REST API，供上层业务调用。

ONF当前只定义了OpenFlow作为南向API，而回避了北向API标准化问题，因此不同的控制器具备有不同的北向API集合。

### SDN东西向接口

东西向协议是必须的，主要是BGP协议；在SDN控制器上运行东西向协议，通过简单的修改或升级控制器程序就能提供新业务。另一方面，东西向协议**为SDN控制器跨域互联及SDN控制器分层部署提供了接口**。

## SDN与NFV

SDN主要是转控分离的思想，至于转发平面和控制平面如何实现，是软件还是可编程硬件，并没有要求。SDN不是具体的技术，只是一种理念，你要用好这个理念有很多种方式。

NFV

### SDN数据平面实现的两个路线: openflow 和 NFV

openflow即使用支持openflow协议的专用交换机来实现数据平面

NFV则是网络功能虚拟化, 主张通过linux+软件交换机形式实现数据平面



## SDN推进经验（ucloud)

1. SDN纯软件

2. OVS改为盛科的 SDN 硬件交换机，解决物理机和公有云之间的互访需求

3. OVS-DPDK引入，解决流表有限的条目问题

4. 控制器改造加入主动推送：在网络拓扑发生变化的时候主动将变化的流表推送到转发面

5. P4可编程交换机和SmartNic智能网卡共同推进：25G网络发展，网络性能提升速度超过了 CPU 性能提升的速度，DPDK需要更强力的CPU才能够达到线速，需要使用硬件卸载的方式来解决

   * 【抛弃】**首先进入我们视野的是基于VXLAN VTEP的解决方案。**此类方案通常由交换机厂商提供包括SDN Controller在内的整套解决方案，比较适合私有云的环境部署。但缺点也很显而易见：封闭、非标准化、无法定制。通常用户只能通过北向厂商特有的API方式和此类方案进行交互。且此类方案通常只支持10w左右的虚拟网络MAC地址，很难满足UCloud的业务需要。此外UCloud对基于Ethernet Over GRE（Linux GRETAP）的Overlay封装有需求，但没有一家硬件交换机支持该Overlay协议。
   * 【抛弃】**接下来我们又把目光投向了支持OpenFlow 1.3协议的硬件交换机。**经过一番预研和测试，我们发现支持OpenFlow 1.3协议的硬件交换机和OVS间存在着巨大的GAP。实际上不可能把我们的OpenFlow流表移植到硬件交换机上。除了同样不支持Ethernet Over GRE协议外，我们OVS上使用的Flow Based Tunneling特性也没有硬件交换机支持。

   * Barefoot的Tofino芯片在2018年初量产后，P4可编程交换机开始逐渐出现在市场上，但仍是一个新兴事物。不可否认目前确实还有一些不足之处，但UCloud确实看到它和之前的交换机相比，能给软件工程师无与伦比的自由度。
   * 目前智能网卡的实现百花齐放，例如：AWS 采用基于通用 ARM 的众核方案、AZure 采用基于 FPGA 的方案、华为云采用基于专用网络处理器（NP）的方案、阿里云采用基于可编程 ASIC 芯片的方案。

当前问题：

1. 主动推送方式存在的问题是，如果虚拟网络规模很大的时候，推送的范围就会很大，可能会造成推送时间过长而导致网络变化无法实时生效。
2. 有状态服务支撑，例如：防火墙、NAT 和安全组：当前希望能够通过智能网卡来卸载有状态业务。

## SD-WAN

> ref: https://www.51cto.com/article/622711.html

1. 公司当前机房线路, 属于公共线路资源. 就是在机房卖机柜, 自己运机器过去安装, 用的是数据中心的网络. 运维的私网是基于gre构建的, 现在有华为交换机支持vxlan, 路由其是用linux主机.
2. SD-WAN的四个功能:
   * 基于WAN, 整合公共线路, MPLS等
   * 动态选路, 故障转移, (网络分级)
   * 完善的监控和快捷的控制调整
   * 支持一般上层业务




