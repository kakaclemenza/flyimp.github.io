---
layout: post
title: 业界加速器技术方案调研
category: net
typora-root-url: ../../..
---

## 目的

了解UU加速器等市面上常见加速器的：技术实现、布点方案、线路带宽、游戏接入等信息，作为后续加速方案决策的参考。



## 加速器原理

### 游戏加速器，其实是一种代理

代理就是一个代表

代表客户端, 就是正向代理, 比如讯游加速器, lantern等

代表服务器, 就是反向代理, 比如CDN技术, 就是反向代理+缓存+就近接入策略; 再如负载均衡就是反向代理+均衡策略

### 代理作用

本质就是在CS模型中加入一个中间层, 而这一个添加, 就带来了很多的可能性. 就像NAT催生了无限的子网划分, 解决了ipv4地址不足等问题一样.

代理作用，总结主要有如下:

* 网络加速：解决客户端与服务端不同运营商问题；解决专用网络就近接入问题；
* 网络扩展：变不可达为可达；实现客户端与服务端的一对多关系，轻松实现负载均衡；
* 提升安全性：充当防火墙，安全策略可以在代理层进行控制，一处代理被攻击可以轻松切换到其他代理，保持服务。

### 业界游戏加速器实现方式

* lsp：仅windows平台支持，**本质上是操作系统对于socket接口行为的一种劫持能力**；通过lsp将数据包的收发由VPN客户端相关函数替代执行，这样VPN客户端就拿到了数据包。后续VPN客户端会为该数据包封装上VPN隧道头，发往VPN服务端，VPN服务端收到隧道包解包后再转发到目标服，就实现了加速效果。
* openvpn：跨平台支持，纯用户态，区别还是在于VPN客户端实现上。openvpn是通过建立tun虚拟网卡，并修改系统路由将应用程序数据包发往tun网卡，VPN客户端再从tun网卡拿到数据包，封装上VPN隧道头发往VPN服务端。
* L2TP、PPTP、IKEv2：这些是内核态提供的隧道技术，数据包收发，隧道包封装解封，都通过系统调用实现，VPN服务端操作系统也要支持相关的协议，一般需要做好配置。



### 国际出口代理加速原理

国际出口代理加速，这里专门指中国三大运营商与国际网络连接的线路出口，该出口存在如下问题：

* 公共网络：总带宽固定，不同运营商策略不同，线路不同，质量也不同。高峰期会进行随机丢包以减少现网压力，最终的出口都会再经过中国网关（GFW）过滤非法内容
* 运营商精品网络（专线）：需要花大价钱购买，也不能排除绕远路问题，不同运营商具备的海外优化线路也不同，选择前要测试清楚

基于该现状，可以铺设的出口代理有：

1. 海外VPS：用户通过公共网络直连海外VPS，海外VPS转发到海外目标服，质量随缘；典型产品如：lantern、expressVPN等
2. 国内VPS：用户通过国内网络连接国内VPS，国内VPS转发到海外目标服，海外目标服通过精心挑选与VPS连通性较好；
3. 购买专线：与方式2相似，不过国内VPS到海外目标服之间，会经过向运营商购买的专线来提速；典型产品如：UU加速器、迅游加速器；实际上这些加速器应该也有使用方式2的线路来降低成本。

参见：https://zhuanlan.zhihu.com/p/64467370



## 加速器测评对比



| 产品             | UU加速器                                                     | 腾讯加速器                                                   | 迅游加速器                                                   | biubiu加速器                                                 |
| ---------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 技术实现         | * PC端两种模式（OpenVPN、LSP）、允许选线路<br />* 移动端OpenVPN路由模式、不支持手动选线路<br /> | * PC端两种模式（OpenVPN、LSP）、允许选线路<br />* 移动端OpenVPN路由模式、不支持手动选线路<br /> | * PC端五种模式（L2TP、PPTP、OpenVPN、LSP、IKEv2）<br />* 移动端OpenVPN路由模式、不支持手动选线路<br /> | * PC端不支持手动选线路<br />* 移动端OpenVPN路由模式、不支持手动选线路<br /> |
| 布点方案         | * 南方：电信、联通、移动<br />* 华中：电信、联通、移动<br />* 华东：电信、联通、移动<br />* 东南：电信、联通、移动<br />* 西南：电信、联通、移动<br />* 北方：电信、联通、移动<br />* 东北：电信、联通、移动<br />* 西北：电信、联通、移动<br /><br />* 全国多网<br />* 教育网<br />* 首尔海外<br />* 日本海外<br />* 东京海外<br />* 香港全球会员<br />* 博力海外<br />* 新加坡海外<br />* 北美海外<br />* 莫斯科海外<br />* 澳洲海外<br />* 欧洲海外<br />* 台北全球会员<br />* 菲律宾海外<br />* 非洲海外<br />* 中东海外<br />* 越南海外 | * 华南<br />* 华中<br />* 华东<br />* 西南<br />* 华北       | * 南方：电信、联通、移动<br />* 华中：电信、联通、移动<br />* 华东：电信、联通、移动<br />* 东南：电信、联通、移动<br />* 西南：电信、联通、移动<br />* 北方：电信、联通、移动<br />* 东北：电信、联通、移动<br />* 西北：电信、联通、移动<br /><br />* 教育网<br />* 华南-国际<br />* 华东-北美<br />* 华北-欧洲<br />* 华北-俄服<br /> | 未知                                                         |
| 大陆连海外服方式 | 测试发现使用的是国内自建机房代理                             | 无                                                           | 测试发现使用的是国内自建机房代理                             | 测试发现使用的是国内云服务器节点代理                         |
| 海外线路带宽     | * 全球500Gbps+巨量专线带宽<br />* 全球自建机房               | 无                                                           | * 带宽未公布<br />* 全球自建机房                             | 未公布                                                       |
| 支持游戏         | * 新游戏可以提申请支持加速<br />* 海外加速收费               | * 新游戏可以提申请支持加速<br /><br />* 关停海外加速         | * 新游戏可以提申请支持加速<br />* 海外加速收费               | * 新游戏可以提申请支持加速<br />* 还不支持神武<br />* 海外加速收费 |
| 其他             | 无                                                           | * 2022.05.31停止海外加速<br />* 加速节点较少，实测神武端游没有成功走加速线路 | 无                                                           | * 阿里间接控股<br />                                         |

其他信息：

1. 腾讯加速器：2022.05.31停止提供服务，推测是不赚钱。
2. taptap手游加速器：2022.09.01停止提供服务，推测是不赚钱。



## 结论

国内玩家访问游戏国际服，方案如下：

1. 走国内VPS+定制的海外目标服：可行性需要多项工作来保证：
   * 由于我们目标服是固定在一个地方，比如日本；那么我们只需要在国内找到一个地方能到达日本这一个地方的网络较好即可。比如上海联通->日本
   * 由于使用的是国际出口，也会存在运营商压力导致随机丢包问题，业务层要具备较好的抗丢包能力，比如利用KCP协议+fec抗丢包。
   * 关于GFW管控问题：一般只要数据不违法，就不会被封控，这点可能不用过分担心。
2. 走专线：选电信CN2 GIA专线，稳定且高速；缺点是贵，但是省心。
3. 找第三方加速器合作提供支持；缺点是玩家需要额外付费，且受制于第三方。