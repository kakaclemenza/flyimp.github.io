---
layout: post
title: 4_用户文档
category: app
typora-root-url: ../../..
---

### 一. 接口说明

GetProxy
作用：发起请求，获取xxmygw代理列表；
接口声明：
参数说明：
* error_type：当前连接情况
	=0: 正常连接
	=1: 直连
	=2: 掉线
	返回值：
	注意事项：


GetProxyCb
作用：传给GetProxy()的回调函数类型，在异步请求收到响应时调用传入的回调通知调用方
接口声明：
参数说明：
返回值：
注意事项：
回调函数是一个函数指针，调用方要注意该指针的有效性问题，如果回调时该指针已失效会导致程序崩溃
回调函数的执行者是一个新的线程，调用方在处理回调数据时要注意互斥访问公共资源问题，否则也会导致程序崩溃问题


Feedback
作用：反馈额外的信息给XXMYGW埋点
接口声明：
参数说明：
* error_type：登陆失败的原因
	* =3: 超时
	* =4: 卡顿
* server: 当前使用的线路
返回值：
注意事项：


GetDelay
作用：获得key对应的测速线路的实时测速结果.
接口声明：
参数说明：
返回值：
注意事项：
1. 默认情况下sdk内部会自动在获取到线路, 调用回调函数后, 发起对每条链路, 网关, baidu的探测. 探测时长为1s1次, 持续10次; GetDelay可以在前10s内获取到探测的实时数值. 或者在10s后获取到最后1s的数值; 内部对于每个key的保留时长为5min
2. 如果期望自定义探测时长或探测目标, 可以使用AddPingItem()接口

AddPingItem
作用：高度可定制的异步ping探测发起接口. 发起探测后可以使用GetDelay()接口实时获取探测结果
接口声明：
参数说明：
返回值：
注意事项：
以key代表探测线路的标识, value代表探测线路

1. key已存在情况下, 不会更改key对应的旧value, 只是延长旧value的探测时间; 所以如果调用方要自定义探测, 最好不要与默认探测的key冲突!
2. value探测时间被延长时, 如果value已经停止探测, 则会重新启动探测
3. sdk内部每5min对所有key做一遍检查, 如果发现该key没有被更新且对应的value也没在测速, 就会删除该key
	=> TODO: 需要添加判断该value没在测速
	=> TODO: 对于长期的探测, 限制其使用数组, 比如传-1表示持续探测, 则结果存在环形队列里循环覆盖
2. 如果期望自定义探测时长或探测目标, 可以使用AddPingItem()接口



### 二. 调用流程

1. InitXxmygwSdk(): 必选; 如果不调用也可以按默认配置运行, 并输出日志到控制台
2. GetProxy(): 可选;
3. Feedback(): 可选; 埋点数据
4. GetDelay(): 可选;
5. AddPingItem(): 可选
