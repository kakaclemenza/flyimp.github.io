---
layout: post
title: etcd,kafka,redis
category: app
typora-root-url: ../..
---

### etcd和redis

etcd的红火来源于kurbernetes用etcd做服务发现，而redis的兴起则来源于memcache缓存本身的局限性。
etcd是一种分布式存储，更强调的是各个节点之间的通信，同步，确保各个节点上数据和事务的一致性，
使得服务发现工作更稳定，本身单节点的写入能力并不强。

redis更像是内存型缓存，虽然也有cluster做主从同步和读写分离，
但节点间的一致性主要强调的是数据，并不在乎事务，因此读写能力很强，qps甚至可以达到10万+

两者都是k-v存储，但redis支持更多的存储模式，包括KEY，STRING，HMAP，SET，SORTEDSET等等，
因此redis本身就可以完成一些比如排序的简单逻辑。而etcd则支持对key的版本记录和txn操作和client对key的watch，因此适合用做服务发现。

日常使用中，etcd主要还是做一些事务管理类的，基础架构服务用的比较多，容器类的服务部署是其主流。
而redis广泛地使用在缓存服务器方面，用作mysql的缓存，通常依据请求量，甚至会做成多级缓存，当然部分情况下也用做存储型redis做持续化存储

**==> 我的理解**

etcd适合于做服务发现(各节点状态监控与分发), 以及集群配置文件分发. 这个功能可以替代掉xxmygw中心服的绝大部分工作. 但etcd为了保持一致性和可靠的实时持久化, 它存取效率并不高, 且它并不对提供丰富的键值对操作能力. redis则相反.

### kafka与etcd

应用场景

**kafka**

1. 消息
    kafka更好的替换传统的消息系统，消息系统被用于各种场景（解耦数据生产者，缓存未处理的消息，等），与大多数消息系统比较，kafka有更好的吞吐量，内置分区，副本和故障转移，这有利于处理大规模的消息。
2. 网络活动追踪
    kafka原本的使用场景：用户的活动追踪，网站的活动（网页游览，搜索或其他用户的操作信息）发布到不同的话题中心，这些消息可实时处理，实时监测，也可加载到Hadoop或离线处理数据仓库。
3. 日志收集
    一个公司可以用Kafka可以收集各种服务的log，通过kafka以统一接口服务的方式开放给各种consumer，例如Hadoop、Hbase等。
4. 流处理
    kafka消息处理包含多个阶段。其中原始输入数据是从kafka主题消费的，然后汇总，丰富，或者以其他的方式处理转化为新主题。
5. 提交日志
    kafka可以作为一种分布式的外部提交日志，日志帮助节点之间复制数据，并作为失败的节点来恢复数据重新同步

**etcd**

1. 配置管理
2. 服务注册于发现
3. 选主
4. 应用调度
5. 分布式队列
6. 分布式锁

**另外一个特性**

kafka的流处理: 

很多时候原始的数据并不是我们想要的，我们想要的是经过处理后的数据结果，比如通过一天的搜索数据得出当天的搜索热点等，你可以利用Streams API来实现自己想要的功能，比如从输入Topic中获取数据，然后再发布到具体的输出Topic中。

Kafka的流处理可以解决诸如处理无序数据、数据的复杂转换等问题

**==> 我的理解**

消息队列, 或者说更直接些是任务队列, 最基本的功能就是缓存生产者的任务, 等待消费者消费该任务.

kafka相比于传统的应用内部实现的多线程共享任务队列, 性能受网络传输影响, 肯定不如传统的消息队列. 那么其优势在哪? 参考它的应用场景, 不难发现kafka作为消息队列主要被用于海量任务场景, 当任务数量在单机上无法及时处理完时, 如何保证任务能可靠的存储, 给多台服务器同时消费任务, 这点是kafka发挥作用的地方.

另一点, kafka提供了对队列数据的流处理, 意味着一些简单的统计工作可以交给kafka完成, 然后应用节点直接到kafka拿加工后的结果即可. 这个可以尝试应用于**XXMYGW的反馈数据统计**



### redis aof超时


